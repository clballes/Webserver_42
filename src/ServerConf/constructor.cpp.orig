/*                                                                            */
/* constructor.cpp                                                            */
/* mpuig-ma <mpuig-ma@student.42barcelona.com>                                */
/* Thu Feb 15 16:49:35 2024                                                   */

#include "Log.hpp"
#include "ServerConf.hpp"
#include <deque>

// We use <deque> because we don't know beforehand
// how many `server {}' there are.

std::deque< const ServerConf * >
ServerConf::instances;

t_configuration_directives
ServerConf::_config_directives[] = {
	{ "listen", &ServerConf::set_listen },
	{ "root", &ServerConf::set_root },
	{ "server_name", &ServerConf::set_server_name },
	{ "error_page", &ServerConf::set_error_page },
	{ "client_body", &ServerConf::set_client_body },
	{ "cgi_param", &ServerConf::set_cgi_param },
	{ "cgi_pass", &ServerConf::set_cgi_pass },
	{ "allow_methods", &ServerConf::set_allow_methods, },
	{ "index", &ServerConf::set_index },
	{ "autoindex", &ServerConf::set_autoindex },
	{ 0x0, 0x0 }};

<<<<<<< HEAD
ServerConf::ServerConf ( void ): good( true )
=======
ServerConf::ServerConf ( void ): good( true ), _allow_methods(0)
>>>>>>> merge_clara
{
	LOG( "call ServerConf::ServerConf( void )" );

	return ;
}

ServerConf::ServerConf ( const ServerConf & instance )
{
	*this = instance;
	
	LOG( "call ServerConf::ServerConf( const ServerConf & )" );
	
	return ;
}

ServerConf::ServerConf ( const std::deque< std::string > & server_block )
{
	this->good = true;
<<<<<<< HEAD

	LOG( "call ServerConf::ServerConf( const std::deque< std::string > &" );
	
	if ( ServerConf::set_directives( server_block ) == EXIT_FAILURE )
	{
		std::cerr << "error: set_directives" << std::endl;
=======
	this->_allow_methods = 0;

	LOG( "call ServerConf( const std::deque< std::string > &" )

	if ( ServerConf::set_directives( server_block ) == EXIT_FAILURE )
	{
		std::cerr << "check_directives" << std::endl;
>>>>>>> merge_clara
		this->good = ! good;
	}
	return ;
}

ServerConf &
ServerConf::operator = ( const ServerConf & instance )
{
	this->good = instance.good;

	this->good = instance.good;

	LOG( "call ServerConf::operator=ServerConf" );

	return (*this);
}

std::ostream &
operator << ( std::ostream & out, const ServerConf & instance )
{
	std::vector< std::string >::const_iterator it;

	out << "listen: " << inet_ntoa( instance._address.sin_addr );              // @mpuig-ma
																			   // Function not allowed
	out << " port: " << ntohs( instance._address.sin_port );

	out << std::endl;

	out << "  server_name:";
	for ( it = instance._server_name.begin();
			it != instance._server_name.end(); ++it )
		out << " " << *it;
	out << std::endl;

	out << "  root: " << instance._root;
	out << std::endl;

<<<<<<< HEAD
	out << "  allow_methods:";
	for ( it = instance._allow_methods.begin();
			it != instance._allow_methods.end(); ++it )
		out << " " << *it;
=======
	out << "Allowed methods: Bitwise representation: ";
	for (int i = 6; i >= 0; --i) {
		out << ((instance._allow_methods & (1 << i)) ? '1' : '0');
	}
>>>>>>> merge_clara
	out << std::endl;
    out << "Allowed methods: String representation: ";
    if (instance._allow_methods & METHOD_GET) {
        out << "GET ";
    }
    if (instance._allow_methods & METHOD_POST) {
        out << "POST ";
    }
    if (instance._allow_methods & METHOD_PUT) {
        out << "PUT ";
    }
    if (instance._allow_methods & METHOD_DELETE) {
        out << "DELETE ";
    }
    out << std::endl;

	out << "  client_max_body_size: " << instance._client_max_body_size;
	out << std::endl;

	out << "  cgi_pass: " << instance._cgi_pass;
	out << std::endl;

	out << "  cgi_param: " << instance._cgi_param;
	out << std::endl;

<<<<<<< HEAD
	out << "  index: " << instance._index;
	out << std::endl;
	
	out << "  autoindex: " << std::boolalpha << instance._autoindex;
	//out << std::endl;
=======
	out << "_index:";
	for ( it = instance._index.begin();
			it != instance._index.end(); ++it )
		out << " " << *it;
	out << std::endl;
	
	if (instance._allow_methods & F_AUTOINDEX) {
        out << "Autoindex: ON ";
	}
	else
        out << "Autoindex: OFF ";

>>>>>>> merge_clara

	return ( out );
}
